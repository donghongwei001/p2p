<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.ZxlUserDao">	
	<!-- 查询用户表所有信息 -->
	<select id="list" resultType="com.entity.ZxlUser">
		select * from usertable
	</select>
	<!-- 向用用户表插入信息 -->
	<insert id="addUser" parameterType="com.entity.ZxlUser">
		insert into usertable values(usertableid.nextval,#{username},#{pwd},0,'否')
	</insert>
	<!-- 查询该用户申请未审核的项目 -->
	<select id="listproject" resultType="com.entity.ZxlMyProject" parameterType="String">
<<<<<<< HEAD
		select p.id,p.projectname,p.money,p.time,c.codename,u.username from projectapplication p,code c,usertable u where u.username=#{username} and p.userid=u.userid and p.aduitstate=c.codeid order by p.id desc
=======
		select p.id,p.projectname,p.money,p.time,c.codename from projectapplication p,code c,usertable u where u.username=#{str} and p.userid=u.userid and p.aduitstate=c.codeid and p.ADUITSTATE =1
	</select>
	<!-- 查询该用户申请已审核项目 -->
	<select id="listprojecttwo" resultType="java.util.HashMap" parameterType="String">
		select p.id,p.projectname,p.money,r.nowmoney,r.begintime,r.lasttime,c.codename ,r.ONEREASON from projectrelease r, projectapplication p,code c,usertable u where u.username=#{name} and p.userid=u.userid and r.status=c.codeid and r.projectid=p.id

>>>>>>> branch 'master' of https://github.com/donghongwei001/p2p
	</select>
	<!-- 查询该用户所投资的项目 -->
<<<<<<< HEAD
	<select id="listmytouzi" resultType="com.entity.ZxlMyTouzi" parameterType="String">
		select p.id,p.projectname,n.money,n.time,u.username from projectapplication p,invest n,usertable u where u.username=#{username} and u.userid=p.userid and p.id=n.subjectid order by n.time desc
=======
	<select id="listmytouzi" resultType="java.util.HashMap" parameterType="String">
		select r.projectid,p.projectname,i.money,i.time,r.lasttime,c.codename from projectrelease r,projectapplication p,invest i,usertable u,code c where u. userid=i.investorid and i.subjectid=p.id and p.id=r.projectid and r.status=c.codeid and u.username=#{name}
>>>>>>> branch 'master' of https://github.com/donghongwei001/p2p
	</select>
	<!-- 查询该用户的基本信息 -->
	<select id="listmypersonal" resultType="com.entity.ZxlMyPersonal" parameterType="String"> 
		select u.userID,u.username,u.pwd,p.personalname,p.iphone,p.mailbox,p.sex,p.educational,p.address,p.worklife,p.occupation from usertable u,psersonalform p where u.username=#{username} and u.userID=p.userid
	</select>
	<!-- 修改密码 -->
	<update id="updatepwd"  parameterType="com.entity.ZxlUser">
		update usertable set pwd=${pwd} where username=${username}
	</update>
	<!-- 查询发布项目 -->
	<select id="listpro" resultType="com.entity.ZxlMyProject">
		select * from (select ps.projectid,p.projectname,p.money,p.lifeloan,p.ratemoney,p.location,pro.personalname,s.name,ps.content from subjectType s,psersonalform pro,projectapplication p,projectrelease ps,usertable us where
		ps.status=5 and ps.projectid=p.id and p.projecttype=s.id and p.userid=pro.userid 
		and p.userid=us.userid order by ps.projectid desc)
		where rownum &lt;=4
	</select>
	<!-- 查询用户余额 -->
	<select id="listmoney" resultType="com.entity.ZxlUser" parameterType="String">
		select u.money,u.username from usertable u where u.username=#{username} 
	</select> 
	<select id="seljine" resultType="int" parameterType="String">
		select money from usertable where username=#{username}
	</select>
	<update id="updatejine">
		update usertable set money=#{0} where username=#{1}
	</update>
	<update id="updatezero" parameterType="String">
		update usertable set money=0 where username=#{username}
	</update>
	<!-- 查询用户未还款项目 -->
	<select id="listhuankuan" resultType="com.entity.ZxlMyHuankuan" parameterType="String">
		select r.repayid,r.projrctid,r.hktime,r.hkmoney,ptmoney,c.codename from repaymoney r,usertable u,code c where u.username=#{username} and r.projrctid=u.userid and r.statu=c.codeid and r.statu=8 
<<<<<<< HEAD
	</select>
	<!-- 查询所有投资项目  -->
	<select id="listtouzi" resultType="com.entity.ZxlTouzi">
		select ps.projectid,p.projectname,p.money,p.lifeloan,p.ratemoney,p.location,pro.personalname,s.name,ps.content from
		subjectType s,psersonalform pro,projectapplication p,projectrelease ps,usertable us where 
		ps.status=5 and ps.projectid=p.id and p.projecttype=s.id and p.userid=pro.userid and p.userid=us.userid order by ps.projectid desc
	</select>

=======
	</select> 
	<select id="seljiekuanren" resultType="java.util.HashMap" parameterType="int">
		select * from projectapplication p,psersonalform f where p.userid=f.userid and p.id=#{id}	
	</select>
	<select id="selhuankuan" resultType="java.util.HashMap">
		select s.time,s.money,s.status from shoukuantable s,usertable u where s.userid=u.userid and u.username=#{0} and s.projectid=#{1}
	</select>
	<select id="selchushen" resultType="java.util.HashMap" parameterType="String">
		select p.id,p.projectname,p.money,p.time,c.codename from firsttable f,projectapplication p,usertable u,code c where f.projectid=p.id and p.userid=u.userid and f.finalstatus=c.codeid and f.firststatus=1 and f.finalstatus=1 and u.username=#{name}
		
	</select>
	<select id="selzhongshen" resultType="java.util.HashMap" parameterType="String">
		select p.id,p.projectname,p.money,p.time,c.codename from finaltable f,projectapplication p,usertable u,code c where f.projectid=p.id and p.userid=u.userid and f.poststatus=c.codeid and f.poststatus=12 and f.finalstatus=1 and u.username=#{name}
	</select>
>>>>>>> branch 'master' of https://github.com/donghongwei001/p2p
</mapper>